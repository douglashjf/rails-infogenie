<div class="container show-container bg-white" >
  <div class="d-flex justify-content-between align-items-center" >
    <%= link_to :back, class: "btn" do %>
        <i class="fa-solid fa-chevron-left text-primary fs-3 px-2"></i>
    <% end %>

    <!-- modal for sharing to whatsapp and twitter -->
    <i class="fa-solid fa-ellipsis-vertical text-primary fs-2 px-3 mx-2" data-bs-toggle="modal" data-bs-target="#exampleModal"></i>

    <div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog ">
        <div class="modal-content options-dropdown bg-primary">

          <div class="modal-body d-flex flex-column justify-content-center align-items-left px-0 py-0 ps-3 ">
            <div class="d-flex">
              <%= link_to whatsapp_share_url, target: "_blank", class:"d-flex align-items-center" do %>
                <p class="text-white my-0">Share on Whatsapp</p>
                <i class="fa-brands fa-whatsapp fs-5 ms-2" style="color: white;"></i>
              <% end %>
            </div>
            <div class="d-flex text-white"> Share to Twitter <i class="fa-brands fa-twitter fs-5 ms-2"></i></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- need to add midjourney banner over here -->
  <div class="py-3 bg-primary mt-2">Midjourney image</div>

  <div class="d-flex justify-content-start align-items-center mt-3">
    <div class="d-flex justify-content-equally">
      <div class="card-title">
        <%= @card.primary_keywords %>
      </div>
      <% if @card.user == current_user %>
        <div class="d-flex align-items-center ms-3">
          <%= link_to card_path(@card), class: "text-primary fs-2", data: { turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
            <i class="fa-regular fa-trash-can"></i>
          <% end %>
        </div>
      <% end %>
      <div class="d-flex align-items-center ms-3" data-controller="favourites-button" data-favourites-button-target="favouritesContainer">
        <% if current_user.favourites.exists?(card: @card) %>
          <%= button_to toggle_favourites_card_path(@card), method: :post, remote: true, class: "favourites-button px-0", data: { action: 'click->favourites-button#toggle', favourites_button_target: 'favourites'} do %>
            <i class="fa-solid fa-heart" style="color: #6d3146; font-size: 30px" data-favourites-button-target="favouriteIcon"></i>
          <% end %>
        <% else %>
          <%= button_to toggle_favourites_card_path(@card), method: :post, remote: true, class: "favourites-button px-0", data: { action: 'click->favourites-button#toggle', favourites_button_target: 'favourites'} do %>
            <i class="fa-regular fa-heart" style="color: #6d3146; font-size: 30px" data-favourites-button-target="favouriteIcon"></i>
            <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="card-poster text-start text-secondary">
      <div class="text-right">Posted by: <%= @card.user.first_name %></div>
    </div>

  <div class="row">
    <div class="category-posters d-flex justify-content-between mt-2 mb-4">
      <div class="category">
        <% @card.categories.each do |category| %>
          <%= button_tag class: "icon-button" do %>
            <%= content_tag(:i, "", class: "fa-solid fa-tag", style: "color: #131417;") %>
            <%= category.tag %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>


  <%# Card content   %>

  <% if @card.summaries.last.present?  %>
    <div>
      <strong>Key Points</strong>

      <div  data-controller="show-slider" data-controller="points-swipe">
        <div class="slider" data-action="touchstart->points-swipe#handleTouchStart">
        <ul>
          <% @card.summaries.last.key_points.each_with_index do |key_point, i| %>

            <div class="slide slide-<%= i %>" style="transform: translateX(<%= i * 110 %>%) " data-show-slider-target="slides" >
              <li><%= key_point %></li>
            </div>

          <% end %>
        </ul>
        </div>
        <div class="slide-buttons">
          <button class="slider_btn slider_btn-left text-center" data-action="click->show-slider#slideLeft"><</button>
          <button class="slider_btn slider_btn-right text-center" data-action="click->show-slider#slideRight">></button>
          <div class="dots">
            <% @card.summaries.last.key_points.each_with_index do |key_point, i| %>
              <button class="dots_dot" data-slide="<%= i %>" data-show-slider-target="dots" ></button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div>
    <!-- This is for Key Questions segment + slider -->
      <strong>Key Questions</strong>
      <div  data-controller="question-slider">
        <div class="q-slider">
        <ul>
          <% @card.summaries.last.key_questions.each_with_index do |key_question, i| %>

            <div class="slide slide-<%= i %>" style="transform: translateX(<%= i * 110 %>%) " data-question-slider-target="qSlides" >
              <li><%= key_question %></li>
            </div>
          <% end %>
        </ul>
        </div>
        <div class="q-slide-buttons">
          <button class="slider_btn slider_btn-left text-center" data-action="click->question-slider#slideLeft"><</button>
          <button class="slider_btn slider_btn-right text-center" data-action="click->question-slider#slideRight">></button>
          <div class="dots">
            <% @card.summaries.last.key_questions.each_with_index do |key_point, i| %>
              <button class="qdots_dot" data-slide="<%= i %>" data-question-slider-target="qDots" ></button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>


    <div class="news-centre m-2 position-relative" data-controller="refresh-news" data-url="<%= refresh_articles_card_path(@card) %>" data-refresh-news-card-id-value="<%= @card.id %>" data-refresh-news-target="link">
      <h5><strong>News Center</strong></h5>
      <button id="refresh-news" data-action="click->refresh-news#refreshArticles" class="refresh-button">Refresh</button>
      <%= render 'refresh' %>
    </div>

    <div class="comments m-2" data-controller="insert-in-comment">
      <h5><strong>Comments</strong></h5>
      <div data-insert-in-comment-target="items">
        <% @card.comments.each do |comment| %>
          <%= render 'cards/comment', comment: comment %>
        <% end %>
      </div>

        <%= render partial: 'commentform', locals: { card: @card, comment: Comment.new} %>

    </div>



  <%#= link_to "", whatsapp_share_url, class: "fab fa-whatsapp" %>

</div>
